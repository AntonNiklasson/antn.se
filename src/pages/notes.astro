---
import { getCollection } from "astro:content";
import FormattedDate from "../components/Date.astro";
import PageLayout from "../layouts/PageLayout.astro";
import { groupBy } from "../utils/group-by";

const raw = await getCollection("blog");
const sorted = raw.sort((a, b) => {
	const x = new Date(a.data.date);
	const y = new Date(b.data.date);
	return y.valueOf() - x.valueOf();
});

const groupedByYear = groupBy(sorted, (post): number => {
	const published = new Date(post.data.date);
	return published.getFullYear();
});
---

<PageLayout>
	<div class="space-y-8">
		{
			Object.entries(groupedByYear)
				.reverse()
				.map(([year, posts]) => {
					return (
						<>
							<section>
								<h3 class="text-lg">{year}</h3>

								<ul class="relative space-y-4 p-4 before:absolute before:left-1 before:top-4 before:block before:h-0 before:w-[2px] before:bg-gray-300 before:transition-all before:duration-500 before:ease-in-out hover:before:h-[calc(90%-16px)]">
									{posts.map((post) => (
										<li>
											<a
												class="block rounded p-2 text-gray-500 transition hover:text-gray-700"
												href={`/${post.slug}`}>
												<h2 class="text-lg">{post.data.title}</h2>
												<FormattedDate date={post.data.date} />
											</a>
										</li>
									))}
								</ul>
							</section>
						</>
					);
				})
		}
	</div>
</PageLayout>
